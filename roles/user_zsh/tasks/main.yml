- name: Setup user
  become: yes
  user:
    name: "{{ user }}"
    shell: /usr/bin/zsh
- name: 'setup oh-my-zsh'
  tags:
    - skip_ansible_lint
  command: 'git clone -c core.autocrlf=input --depth=1 https://github.com/robbyrussell/oh-my-zsh.git .oh-my-zsh'
  args:
    chdir: '~{{ user }}'
    creates: '~{{ user }}/.oh-my-zsh'
- name: 'set permissions of oh-my-zsh'
  file:
    path: '~{{ user }}/.oh-my-zsh'
    mode: 'go-w'
    recurse: yes
- name: 'write .zshrc'
  template:
    src: zshrc.j2
    dest: '~{{ user }}/.zshrc'
    backup: yes
    mode: 'u=rw,go=r'
- name: 'write .zshenv'
  template:
    src: zshenv.j2
    dest: '~{{ user }}/.zshenv'
    backup: yes
    mode: 'u=rw,go=r'